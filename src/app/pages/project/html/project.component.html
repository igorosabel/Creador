<mat-toolbar color="primary">
  <mat-toolbar-row>
    <button mat-icon-button routerLink="/main">
		<mat-icon>arrow_back</mat-icon>
	</button>
	<span>Creador: {{project.name}}</span>
	<span class="flex-space"></span>
	<button mat-icon-button (click)="saveProject()" *ngIf="!savingProject">
		<mat-icon>save</mat-icon>
	</button>
	<img src="assets/loading.svg" class="loading-img" *ngIf="savingProject">
  </mat-toolbar-row>
</mat-toolbar>

<mat-card class="center-card-big">
  <mat-card-content>
    <mat-tab-group>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">assignment</mat-icon>
          Proyecto
        </ng-template>
        <div class="tab-top-margin center-card-fields">
          <mat-form-field appearance="outline">
            <mat-label>Nombre del proyecto</mat-label>
            <input matInput [(ngModel)]="project.name" required name="name">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Descripción</mat-label>
            <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="5" cdkAutosizeMaxRows="15" [(ngModel)]="project.description" ></textarea>
          </mat-form-field>
        </div>
      </mat-tab>

      <mat-tab>
	    <ng-template mat-tab-label>
          <mat-icon class="tab-icon">build</mat-icon>
          Configuración
        </ng-template>
        <div class="project-line" (click)="deploy('general')">
          <span>General</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.general}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.general}">
          <mat-form-field appearance="outline">
            <mat-label>Base URL</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.baseUrl" name="base_url">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Admin email</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.adminEmail" name="admin_email">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Título por defecto</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.defaultTitle" name="default_title">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Idioma del sitio</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.lang" name="lang">
          </mat-form-field>
        </div>
        <div class="project-line" (click)="deploy('db')">
          <span>Base de datos</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.db}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.db}">
          <div class="project-line-title">
            <span>Acceso a Base de datos</span>
            <mat-slide-toggle [checked]="projectConfiguration.hasDB" (change)="changeHasDB()"></mat-slide-toggle>
          </div>
          <mat-form-field appearance="outline">
            <mat-label>Host</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.dbHost" name="db_host" [disabled]="!projectConfiguration.hasDB">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Nombre de la BD</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.dbName" name="db_name" [disabled]="!projectConfiguration.hasDB">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Usuario</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.dbUser" name="db_user" [disabled]="!projectConfiguration.hasDB">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Contraseña</mat-label>
            <input type="password" matInput [(ngModel)]="projectConfiguration.dbPass" name="db_pass" [disabled]="!projectConfiguration.hasDB">
          </mat-form-field>
        </div>
        <div class="project-line" (click)="deploy('cookies')">
          <span>Cookies</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.cookies}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.cookies}">
          <mat-form-field appearance="outline">
            <mat-label>Prefijo de las cookies</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.cookiesPrefix" name="cookies_prefix">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>URL de las cookies</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.cookiesUrl" name="cookies_url">
          </mat-form-field>
        </div>
        <div class="project-line" (click)="deploy('baseModules')">
          <span>Módulos base</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.baseModules}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.baseModules}">
          <div class="project-line-title">
            <span>Browser</span>
            <mat-slide-toggle [checked]="projectConfiguration.modBrowser" (change)="changeModule('modBrowser')"></mat-slide-toggle>
          </div>
          <div class="project-line-title">
            <span>Email</span>
            <mat-slide-toggle [checked]="projectConfiguration.modEmail" (change)="changeModule('modEmail')"></mat-slide-toggle>
          </div>
          <div class="project-line-title">
            <span>Email SMTP</span>
            <mat-slide-toggle [checked]="projectConfiguration.modEmailSmtp" (change)="changeModule('modEmailSmtp')" [disabled]="!projectConfiguration.modEmail"></mat-slide-toggle>
          </div>
          <div class="sub-fields" [ngClass]="{'sub-fields-deployed': projectConfiguration.modEmailSmtp}">
            <div class="project-line-title">
              <span>Parámetros para el envío de emails mediante SMTP</span>
            </div>
            <mat-form-field appearance="outline">
              <mat-label>Host</mat-label>
              <input matInput [(ngModel)]="projectConfiguration.smtpHost" name="smtp_host">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Puerto</mat-label>
              <input matInput [(ngModel)]="projectConfiguration.smtpPort" name="smtp_port">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Seguridad</mat-label>
              <input matInput [(ngModel)]="projectConfiguration.smtpSecure" name="smtp_secure">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Usuario</mat-label>
              <input matInput [(ngModel)]="projectConfiguration.smtpUser" name="smtp_user">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Contraseña</mat-label>
              <input type="password" matInput [(ngModel)]="projectConfiguration.smtpPass" name="smtp_pass">
            </mat-form-field>
          </div>
          <div class="project-line-title">
            <span>FTP</span>
            <mat-slide-toggle [checked]="projectConfiguration.modFtp" (change)="changeModule('modFtp')"></mat-slide-toggle>
          </div>
          <div class="project-line-title">
            <span>Image</span>
            <mat-slide-toggle [checked]="projectConfiguration.modImage" (change)="changeModule('modImage')"></mat-slide-toggle>
          </div>
          <div class="project-line-title">
            <span>PDF</span>
            <mat-slide-toggle [checked]="projectConfiguration.modPdf" (change)="changeModule('modPdf')"></mat-slide-toggle>
          </div>
          <div class="project-line-title">
            <span>Translate</span>
            <mat-slide-toggle [checked]="projectConfiguration.modTranslate" (change)="changeModule('modTranslate')"></mat-slide-toggle>
          </div>
          <div class="project-line-title">
            <span>Crypt</span>
            <mat-slide-toggle [checked]="projectConfiguration.modCrypt" (change)="changeModule('modCrypt')"></mat-slide-toggle>
          </div>
        </div>
        <div class="project-line" (click)="deploy('errors')">
          <span>Errores</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.errors}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.errors}">
          <mat-form-field appearance="outline">
            <mat-label>URL página de error 403</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.error403" name="error_403">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>URL página de error 404</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.error404" name="error_404">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>URL página de error 500</mat-label>
            <input matInput [(ngModel)]="projectConfiguration.error500" name="error_500">
          </mat-form-field>
        </div>
        <div class="project-line" (click)="deploy('css')">
          <span>CSS</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.css}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.css}">
          <div>
            <mat-form-field appearance="outline" class="field-value">
              <mat-label>CSS</mat-label>
              <input matInput [(ngModel)]="newItem.css" name="new_css">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('css')" [disabled]="newItem.css==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.css; let i = index">
              {{item}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('css', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.css.length==0">
              No hay ningún elemento.
            </div>
          </div>
          <div>
		        <mat-form-field appearance="outline" class="field-value">
              <mat-label>CSS Externos</mat-label>
              <input matInput [(ngModel)]="newItem.cssExt" name="new_css_ext">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('cssExt')" [disabled]="newItem.cssExt==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.cssExt; let i = index">
              {{item}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('cssExt', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.cssExt.length==0">
              No hay ningún elemento.
            </div>
          </div>
        </div>
        <div class="project-line" (click)="deploy('js')">
          <span>JS</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.js}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.js}">
          <div>
            <mat-form-field appearance="outline" class="field-value">
              <mat-label>JS</mat-label>
              <input matInput [(ngModel)]="newItem.js" name="new_js">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('js')" [disabled]="newItem.js==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.js; let i = index">
              {{item}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('js', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.js.length==0">
              No hay ningún elemento.
            </div>
          </div>
          <div>
            <mat-form-field appearance="outline" class="field-value">
              <mat-label>JS Externos</mat-label>
              <input matInput [(ngModel)]="newItem.jsExt" name="new_js_ext">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('jsExt')" [disabled]="newItem.jsExt==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.jsExt; let i = index">
              {{item}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('jsExt', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.jsExt.length==0">
              No hay ningún elemento.
            </div>
          </div>
        </div>
        <div class="project-line" (click)="deploy('libs')">
          <span>Librerías</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.libs}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.libs}">
          <div>
            <mat-form-field appearance="outline" class="field-value">
              <mat-label>Librería</mat-label>
              <input matInput [(ngModel)]="newItem.libs" name="new_lib">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('libs')" [disabled]="newItem.libs==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.libs; let i = index">
              {{item}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('libs', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.libs.length==0">
              No hay ningún elemento.
            </div>
          </div>
        </div>
        <div class="project-line" (click)="deploy('extra')">
          <span>Valores extra</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.extra}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.extra}">
          <div>
            <mat-form-field appearance="outline" class="field-key">
              <mat-label>Clave</mat-label>
              <input matInput [(ngModel)]="newItem.extraKey" name="new_extra_key">
            </mat-form-field>
            <mat-form-field appearance="outline" class="field-value">
              <mat-label>Valor</mat-label>
              <input matInput [(ngModel)]="newItem.extraValue" name="new_extra_value">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('extra')" [disabled]="newItem.extraKey=='' || newItem.extraValue==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.extra; let i = index">
              <strong>{{item.key}}</strong> {{item.value}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('extra', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.extra.length==0">
              No hay ningún elemento.
            </div>
          </div>
        </div>
        <div class="project-line" (click)="deploy('dir')">
          <span>Directorios</span>
          <mat-icon class="project-line-icon" [ngClass]="{'project-line-icon-rotate': row.dir}">expand_more</mat-icon>
        </div>
        <div class="project-sub-line" [ngClass]="{'project-sub-line-deployed': row.dir}">
          <div>
            <mat-form-field appearance="outline" class="field-key">
              <mat-label>Clave</mat-label>
              <input matInput [(ngModel)]="newItem.dirKey" name="new_dir_key">
            </mat-form-field>
            <mat-form-field appearance="outline" class="field-value">
              <mat-label>Valor</mat-label>
              <input matInput [(ngModel)]="newItem.dirValue" name="new_dir_value">
            </mat-form-field>
            <button mat-raised-button color="primary" class="field-button" (click)="addNew('dir')" [disabled]="newItem.dirKey=='' || newItem.dirValue==''">Añadir</button>
          </div>
          <div class="project-list">
            <div class="project-list-item" *ngFor="let item of projectConfigurationLists.dir; let i = index">
              <strong>{{item.key}}</strong> {{item.value}}
              <mat-icon class="project-list-item-icon" (click)="deleteNew('dir', i)">close</mat-icon>
            </div>
            <div class="project-list-item" *ngIf="projectConfigurationLists.dir.length==0">
              No hay ningún elemento.
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">view_list</mat-icon>
          Modelo
        </ng-template>
        <div class="project-header">
          <button mat-raised-button color="primary" (click)="addModel()">Añadir modelo</button>
        </div>

        <mat-card class="project-card" *ngFor="let model of projectModel; let i = index">
          <mat-card-content>
            <div class="project-model-header">
              <mat-form-field appearance="outline" class="field-key">
                <mat-label>Nombre</mat-label>
                <input matInput [(ngModel)]="model.name" name="model_name">
              </mat-form-field>
              <mat-form-field appearance="outline" class="field-key">
                <mat-label>Nombre de la tabla</mat-label>
                <input matInput [(ngModel)]="model.tableName" name="model_table_name">
              </mat-form-field>
              <button mat-raised-button color="warn" (click)="deleteModel(i)">Borrar</button>
              <button mat-raised-button color="primary" (click)="addModelRow(i)">Añadir campo</button>
            </div>
			<div class="project-model-row" *ngFor="let row of model.rows; let j = index">
			  <mat-form-field appearance="outline">
                <mat-label>Nombre</mat-label>
                <input matInput [(ngModel)]="row.name" name="row_name">
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Tipo</mat-label>
                <mat-select [(value)]="row.type">
                  <mat-option *ngFor="let opt of modelRowTypes" [value]="opt.id">{{opt.name}}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" *ngIf="row.type==6">
                <mat-label>Tamaño</mat-label>
                <input matInput [(ngModel)]="row.size" name="row_size">
              </mat-form-field>
              <mat-checkbox [(ngModel)]="row.autoIncrement" *ngIf="row.type==1">Auto increment</mat-checkbox>
              <mat-checkbox [(ngModel)]="row.nullable" *ngIf="row.type==4 || row.type==5 || row.type==6 || row.type==7 || row.type==9 || row.type==10">Null?</mat-checkbox>
              <mat-form-field appearance="outline" *ngIf="row.type==5 || row.type==6 || row.type==7 || row.type==9 || row.type==10">
                <mat-label>Valor por defecto</mat-label>
                <input matInput [(ngModel)]="row.defaultValue" name="row_default">
              </mat-form-field>
              <mat-form-field appearance="outline" *ngIf="row.type==8">
                <mat-label>Valor por defecto</mat-label>
                <mat-select [(value)]="row.defaultValue">
                  <mat-option [value]="true">True</mat-option>
                  <mat-option [value]="false">False</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Referencia</mat-label>
                <input matInput [(ngModel)]="row.ref" name="row_ref">
              </mat-form-field>
              <button mat-raised-button color="warn" class="project-model-row-delete" (click)="deleteModelRow(i, j)">Borrar</button>
              <mat-form-field appearance="outline" class="project-model-comment">
                <mat-label>Comentario</mat-label>
                <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="2" cdkAutosizeMaxRows="15" [(ngModel)]="row.comment"></textarea>
              </mat-form-field>
			</div>
			<div class="project-model-row" *ngIf="model.rows.length==0">Todavía no hay ningún campo en este modelo.</div>
          </mat-card-content>
        </mat-card>

      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">library_add</mat-icon>
          Incluir
        </ng-template>
        <fieldset *ngFor="let inc of includeTypes" class="project-include">
          <legend>{{inc.name | urldecode}}</legend>
          <mat-radio-group aria-label="Select an option" [(ngModel)]="inc.selected">
            <mat-list role="list">
              <mat-list-item *ngFor="let version of inc.versions">
                <div class="project-include-row">
                  {{version.version}}
                  <mat-radio-button [value]="version.id"></mat-radio-button>
                </div>
              </mat-list-item>
            </mat-list>
          </mat-radio-group>
        </fieldset>
      </mat-tab>

    </mat-tab-group>
  </mat-card-content>
</mat-card>